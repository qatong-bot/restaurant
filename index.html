<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Êô∫ËÉΩÈ§êÂéÖ‰ºöÂëòÁÇπÈ§êÁ≥ªÁªü</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#f4f6f9}
header{background:#ff6b6b;color:white;padding:15px 25px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
.cart-icon{position:relative;cursor:pointer;font-size:20px}
.cart-badge{position:absolute;top:-8px;right:-10px;background:#2ed573;color:white;font-size:12px;padding:2px 6px;border-radius:50%}
.category-bar{display:flex;gap:10px;padding:15px 30px;flex-wrap:wrap;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.05)}
.category-btn{padding:6px 14px;border:none;border-radius:20px;background:#eee;cursor:pointer}
.category-btn.active{background:#ff6b6b;color:white}
.menu{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;padding:30px;transition:margin-right 0.4s}
.card{background:white;border-radius:14px;overflow:hidden;box-shadow:0 6px 15px rgba(0,0,0,0.06);transition:.3s;cursor:pointer}
.card:hover{transform:translateY(-6px)}
.card img{width:100%;height:160px;object-fit:cover}
.card-body{padding:15px}
.price{color:#ff6b6b;font-weight:bold;margin:8px 0}
.add-btn{width:100%;padding:8px;border:none;background:#ff6b6b;color:white;border-radius:8px;cursor:pointer}
.cart{position:fixed;right:10px;top:80px;width:320px;height:80%;background:white;box-shadow:0 0 15px rgba(0,0,0,0.2);padding:20px;overflow-y:auto;z-index:200;border-radius:12px}
.cart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
.close-cart{cursor:pointer;font-size:18px;color:#999}
.close-cart:hover{color:#ff4757}
.cart-item{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.qty-btn{background:#ff6b6b;border:none;color:white;width:22px;height:22px;border-radius:50%;cursor:pointer;font-size:12px}
.remove-btn{background:none;border:none;color:#ff4757;cursor:pointer;font-size:12px}
.summary-line{display:flex;justify-content:space-between;margin-top:5px}
.total{margin-top:10px;font-weight:bold;font-size:16px}
.checkout{margin-top:15px;width:100%;padding:10px;background:#2ed573;border:none;color:white;border-radius:8px;cursor:pointer}
#langSelect{padding:6px 10px;border-radius:6px;cursor:pointer;position:fixed;top:15px;right:80px;z-index:2000;}
.order-history-btn{position:fixed;bottom:20px;right:20px;z-index:2000;padding:8px 14px;border:none;border-radius:50px;cursor:pointer;background:#fff;color:#333;font-weight:500;box-shadow:0 2px 6px rgba(0,0,0,0.15);transition:all .2s;}
.order-history-btn:hover{background:#ff6b6b;color:#fff;transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2);}
#orderHistory{display:none;position:fixed;bottom:70px;right:20px;width:320px;height:60%;background:white;box-shadow:0 0 15px rgba(0,0,0,0.2);padding:20px;overflow-y:auto;z-index:250;border-radius:12px}
#orderHistory h2{margin-bottom:10px}
#orderHistory .close-history{cursor:pointer;float:right;color:#999;font-size:16px}
#orderHistory .order-entry{border-bottom:1px solid #ddd;margin-bottom:10px;padding-bottom:5px;font-size:14px}
.logout-btn{padding:6px 12px;border:none;border-radius:6px;background:#fff;color:#ff6b6b;font-weight:bold;cursor:pointer;margin-left:10px}
.logout-btn:hover{background:#ff4757;color:#fff;}
@media(max-width:768px){.menu{padding:15px}.cart{width:95%}.order-history-btn{bottom:70px;right:15px}}
</style>
</head>
<body>

<select id="langSelect" onchange="setLang(this.value)">
  <option value="zh">‰∏≠Êñá</option>
  <option value="en">EN</option>
  <option value="bm">BM</option>
</select>

<button class="order-history-btn" onclick="viewOrderHistory()"><span id="orderHistoryBtnText">ËÆ¢ÂçïÂéÜÂè≤</span></button>

<header>
<h1 id="title">üçΩÔ∏è Êô∫ËÉΩÈ§êÂéÖ</h1>
<div>
  <span id="userDisplay"></span>
  <button class="logout-btn" onclick="logout()">ÁôªÂá∫</button>
</div>
<div class="cart-icon" onclick="toggleCart()">üõí<span class="cart-badge" id="cartCount">0</span></div>
</header>

<div class="category-bar" id="categoryBar"></div>
<div class="menu" id="menu"></div>

<div class="cart" id="cart">
<div class="cart-header">
<h2 id="cartTitle">Ë¥≠Áâ©ËΩ¶</h2>
<span class="close-cart" onclick="closeCart()">‚úñ</span>
</div>
<div id="cartItems"></div>

<div class="summary-line"><span id="labelSubtotal"></span><span id="subtotal">RM 0.00</span></div>
<div class="summary-line"><span id="labelSST"></span><span id="sst">RM 0.00</span></div>
<div class="summary-line"><span id="labelService"></span><span id="service">RM 0.00</span></div>
<div class="total summary-line"><span id="labelGrandTotal"></span><span id="grandTotal">RM 0.00</span></div>

<button class="checkout" onclick="checkout()" id="checkoutBtn">Á´ãÂç≥ÁªìÁÆó</button>
</div>

<div id="orderHistory">
<h2 id="orderHistoryTitle">ËÆ¢ÂçïÂéÜÂè≤</h2>
<span class="close-history" onclick="closeOrderHistory()">‚úñ</span>
<div id="historyList"></div>
</div>

<script>
const SST_RATE=0.06,SERVICE_RATE=0.10;
const dishes=[
{ name:{zh:'ÁâõÊéí',en:'Steak',bm:'Bistik'}, price:88, category:'‰∏ªÈ£ü', img:'https://via.placeholder.com/400'},
{ name:{zh:'Êä´Ëê®',en:'Pizza',bm:'Piza'}, price:58, category:'‰∏ªÈ£ü', img:'https://via.placeholder.com/400'},
{ name:{zh:'ÊÑèÈù¢',en:'Pasta',bm:'Pasta'}, price:48, category:'‰∏ªÈ£ü', img:'https://via.placeholder.com/400'},
{ name:{zh:'Ê±âÂ†°',en:'Burger',bm:'Burger'}, price:36, category:'‰∏ªÈ£ü', img:'https://via.placeholder.com/400'},
{ name:{zh:'ËñØÊù°',en:'French Fries',bm:'Kentang Goreng'}, price:15, category:'Â∞èÂêÉ', img:'https://via.placeholder.com/400'},
{ name:{zh:'Â•∂Ëå∂',en:'Milk Tea',bm:'Teh Susu'}, price:18, category:'È•ÆÂìÅ', img:'https://via.placeholder.com/400'}
];

let currentUser = localStorage.getItem("currentUser");
if(!currentUser){
  alert("ËØ∑ÂÖàÁôªÂΩïÔºÅ");
  window.location.href="login.html";
}

document.getElementById("userDisplay").innerText="‰ºöÂëò: "+currentUser;

let cart=[];
let currentLang="zh";
const translations={
zh:{title:"üçΩÔ∏è Êô∫ËÉΩÈ§êÂéÖ",cart:"Ë¥≠Áâ©ËΩ¶",add:"Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶",checkout:"Á´ãÂç≥ÁªìÁÆó",subtotal:"Â∞èËÆ°",tax:"SST 6%",service:"ÊúçÂä°Ë¥π 10%",grandTotal:"ÊÄªÈáëÈ¢ù", remove:"Âà†Èô§", noOrders:"ÊöÇÊó†ËÆ¢Âçï", orderHistory:"ËÆ¢ÂçïÂéÜÂè≤"},
en:{title:"üçΩÔ∏è Smart Restaurant",cart:"Cart",add:"Add to Cart",checkout:"Checkout",subtotal:"Subtotal",tax:"SST 6%",service:"Service Charge 10%",grandTotal:"Grand Total", remove:"Remove", noOrders:"No Orders", orderHistory:"Order History"},
bm:{title:"üçΩÔ∏è Restoran Pintar",cart:"Troli",add:"Tambah",checkout:"Bayar",subtotal:"Jumlah",tax:"Cukai SST 6%",service:"Caj Perkhidmatan 10%",grandTotal:"Jumlah Keseluruhan", remove:"Buang", noOrders:"Tiada Pesanan", orderHistory:"Sejarah Pesanan"}
};

function formatMoney(num){return "RM "+num.toFixed(2);}
function renderCategories(){
  const bar=document.getElementById("categoryBar");
  bar.innerHTML="";
  const cats=["ÂÖ®ÈÉ®",...new Set(dishes.map(d=>d.category))];
  cats.forEach(cat=>{
    bar.innerHTML+=`<button class="category-btn" onclick="filterCategory('${cat}')">${cat}</button>`;
  });
}
function filterCategory(cat){renderMenu(cat);}
function renderMenu(cat="ÂÖ®ÈÉ®"){
  const menu=document.getElementById("menu");
  menu.innerHTML="";
  const list=cat==="ÂÖ®ÈÉ®"?dishes:dishes.filter(d=>d.category===cat);
  list.forEach(d=>{
    menu.innerHTML+=`<div class="card" onclick="addToCart('${d.name.zh}')">
      <img src="${d.img}">
      <div class="card-body">
        <h3>${d.name[currentLang]}</h3>
        <p class="price">${formatMoney(d.price)}</p>
      </div>
    </div>`;
  });
}

function addToCart(nameZh){
  const item=cart.find(i=>i.nameZh===nameZh);
  if(item) item.qty++; else {const dish=dishes.find(d=>d.name.zh===nameZh);cart.push({...dish,qty:1,nameZh});}
  saveCart();
  document.getElementById("cart").scrollIntoView({behavior:"smooth"});
}

function changeQty(nameZh,delta){const item=cart.find(i=>i.nameZh===nameZh);if(!item) return;item.qty+=delta;if(item.qty<=0) cart=cart.filter(i=>i.nameZh!==nameZh);saveCart();}
function removeItem(nameZh){cart=cart.filter(i=>i.nameZh!==nameZh);saveCart();}
function saveCart(){localStorage.setItem("cart_"+currentUser,JSON.stringify(cart));renderCart();}
function renderCart(){
  const box=document.getElementById("cartItems");box.innerHTML="";
  let subtotal=0,count=0;
  cart.forEach(i=>{subtotal+=i.price*i.qty;count+=i.qty;
    box.innerHTML+=`<div class="cart-item">
      <div>${i.name[currentLang]} x${i.qty}<br>
        <button class="qty-btn" onclick="changeQty('${i.nameZh}',-1)">-</button> ${i.qty} <button class="qty-btn" onclick="changeQty('${i.nameZh}',1)">+</button>
      </div>
      <div>${formatMoney(i.price*i.qty)}<br>
        <button class="remove-btn" onclick="removeItem('${i.nameZh}')">${translations[currentLang].remove}</button>
      </div>
    </div>`;
  });
  const sst=subtotal*SST_RATE, service=subtotal*SERVICE_RATE, grand=subtotal+sst+service;
  document.getElementById("labelSubtotal").innerText=translations[currentLang].subtotal;
  document.getElementById("subtotal").innerText=formatMoney(subtotal);
  document.getElementById("labelSST").innerText=translations[currentLang].tax;
  document.getElementById("sst").innerText=formatMoney(sst);
  document.getElementById("labelService").innerText=translations[currentLang].service;
  document.getElementById("service").innerText=formatMoney(service);
  document.getElementById("labelGrandTotal").innerText=translations[currentLang].grandTotal;
  document.getElementById("grandTotal").innerText=formatMoney(grand);
  document.getElementById("cartCount").innerText=count;
}

function toggleCart(){const c=document.getElementById("cart");c.style.display=c.style.display==="block"?"none":"block";}
function closeCart(){document.getElementById("cart").style.display="none";}
function checkout(){
  if(!cart.length){alert("Ë¥≠Áâ©ËΩ¶‰∏∫Á©∫"); return;}
  let subtotal=cart.reduce((sum,i)=>sum+i.price*i.qty,0);
  let sst=subtotal*SST_RATE, service=subtotal*SERVICE_RATE, grand=subtotal+sst+service;
  // ‰øùÂ≠òËÆ¢Âçï
  let orders=JSON.parse(localStorage.getItem("orders_"+currentUser))||[];
  orders.push({time:new Date().toLocaleString(),items:cart,subtotal,sst,service,grand});
  localStorage.setItem("orders_"+currentUser,JSON.stringify(orders));
  alert("‰∏ãÂçïÊàêÂäüÔºÅ");
  cart=[]; saveCart();
}

function viewOrderHistory(){
  const historyDiv=document.getElementById("orderHistory");
  const historyList=document.getElementById("historyList"); historyList.innerHTML="";
  const orders=JSON.parse(localStorage.getItem("orders_"+currentUser))||[];
  if(orders.length===0){historyList.innerHTML=`<p>${translations[currentLang].noOrders}</p>`;}
  else{
    orders.slice().reverse().forEach((o,i)=>{
      let itemsHTML=o.items.map(it=>`${it.name[currentLang]} x${it.qty}`).join("<br>");
      historyList.innerHTML+=`<div class="order-entry"><strong>${translations[currentLang].orderHistory} ${orders.length-i} - ${o.time}</strong><br>${itemsHTML}<br>
      <em>ÊÄªÈ¢ù: RM ${o.grand.toFixed(2)}</em></div>`;
    });
  }
  historyDiv.style.display="block";
}
function closeOrderHistory(){document.getElementById("orderHistory").style.display="none";}
function setLang(lang){currentLang=lang;renderCategories();renderMenu();renderCart();}
function logout(){
  localStorage.removeItem("currentUser");
  window.location.href="login.html";
}

renderCategories();renderMenu();renderCart();
</script>
</body>
</html>
