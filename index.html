<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Êô∫ËÉΩÈ§êÂéÖËèúÂçï</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#f4f6f9}
header{background:#ff6b6b;color:white;padding:15px 25px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
.cart-icon{position:relative;cursor:pointer;font-size:20px}
.cart-badge{position:absolute;top:-8px;right:-10px;background:#2ed573;color:white;font-size:12px;padding:2px 6px;border-radius:50%}
.category-bar{display:flex;gap:10px;padding:15px 30px;flex-wrap:wrap;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.05)}
.category-btn{padding:6px 14px;border:none;border-radius:20px;background:#eee;cursor:pointer}
.category-btn.active{background:#ff6b6b;color:white}
.menu{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;padding:30px;transition:margin-right 0.4s}
.card{background:white;border-radius:14px;overflow:hidden;box-shadow:0 6px 15px rgba(0,0,0,0.06);transition:.3s;cursor:pointer}
.card:hover{transform:translateY(-6px)}
.card img{width:100%;height:160px;object-fit:cover}
.card-body{padding:15px}
.price{color:#ff6b6b;font-weight:bold;margin:8px 0}
.add-btn{width:100%;padding:8px;border:none;background:#ff6b6b;color:white;border-radius:8px;cursor:pointer}
.cart{position:fixed;right:-350px;top:0;width:320px;height:100%;background:white;box-shadow:-4px 0 15px rgba(0,0,0,0.1);transition:.4s;padding:20px;overflow-y:auto;z-index:200}
.cart.open{right:0}
.cart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
.close-cart{cursor:pointer;font-size:18px;color:#999}
.close-cart:hover{color:#ff4757}
.cart-item{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.qty-btn{background:#ff6b6b;border:none;color:white;width:22px;height:22px;border-radius:50%;cursor:pointer;font-size:12px}
.remove-btn{background:none;border:none;color:#ff4757;cursor:pointer;font-size:12px}
.summary-line{display:flex;justify-content:space-between;margin-top:5px;align-items:center}
.total{margin-top:10px;font-weight:bold;font-size:16px}
.checkout{margin-top:15px;width:100%;padding:10px;background:#2ed573;border:none;color:white;border-radius:8px;cursor:pointer}
#langSelect{padding:6px 10px;border-radius:6px;cursor:pointer;position:fixed;top:15px;right:80px;z-index:2000;}
.order-history-btn{position:fixed;bottom:20px;right:20px;z-index:2000;padding:8px 14px;border:none;border-radius:50px;cursor:pointer;background:#fff;color:#333;font-weight:500;box-shadow:0 2px 6px rgba(0,0,0,0.15);transition:all .2s;}
.order-history-btn:hover{background:#ff6b6b;color:#fff;transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2);}
#orderHistory{display:none;position:fixed;bottom:70px;right:20px;width:320px;height:60%;background:white;box-shadow:0 0 15px rgba(0,0,0,0.2);padding:20px;overflow-y:auto;z-index:250;border-radius:12px}
#orderHistory h2{margin-bottom:10px}
#orderHistory .close-history{cursor:pointer;float:right;color:#999;font-size:16px}
#orderHistory .order-entry{border-bottom:1px solid #ddd;margin-bottom:10px;padding-bottom:5px;font-size:14px}
@media(max-width:768px){.menu{padding:15px}.cart{width:100%}.order-history-btn{bottom:70px;right:15px}}
</style>
</head>
<body>

<select id="langSelect">
  <option value="zh">‰∏≠Êñá</option>
  <option value="en">EN</option>
  <option value="bm">BM</option>
</select>

<button class="order-history-btn" onclick="viewOrderHistory()">ËÆ¢ÂçïÂéÜÂè≤</button>

<header>
<h1 id="title">üçΩÔ∏è Êô∫ËÉΩÈ§êÂéÖ</h1>
<div>
  <span id="userDisplay"></span>
  <button id="logoutBtn" onclick="logout()">ÁôªÂá∫</button>
</div>
<div class="cart-icon" onclick="toggleCart()">üõí<span class="cart-badge" id="cartCount">0</span></div>
</header>

<div class="category-bar" id="categoryBar"></div>
<div class="menu" id="menu"></div>

<div class="cart" id="cart">
<div class="cart-header">
<h2>Ë¥≠Áâ©ËΩ¶</h2>
<span class="close-cart" onclick="closeCart()">‚úñ</span>
</div>
<div id="cartItems"></div>

<div class="summary-line"><span>Â∞èËÆ°</span><span id="subtotal">RM 0.00</span></div>
<div class="summary-line"><span>SST 6%</span><span id="sst">RM 0.00</span></div>
<div class="summary-line"><span>ÊúçÂä°Ë¥π 10%</span><span id="service">RM 0.00</span></div>
<div class="summary-line">
<span>ÊäòÊâ£
<select id="discountSelect" onchange="renderCart()">
  <option value="0">0%</option>
  <option value="5">5%</option>
  <option value="10">10%</option>
  <option value="15">15%</option>
  <option value="20">20%</option>
</select>
</span>
<span id="discount">RM 0.00</span>
</div>
<div class="total summary-line"><span>ÊÄªÈáëÈ¢ù</span><span id="grandTotal">RM 0.00</span></div>
<button class="checkout" onclick="checkout()">Á´ãÂç≥ÁªìÁÆó</button>
</div>

<div id="orderHistory">
<h2>ËÆ¢ÂçïÂéÜÂè≤</h2>
<span class="close-history" onclick="closeOrderHistory()">‚úñ</span>
<div id="historyList"></div>
</div>

<script>
const SST_RATE=0.06, SERVICE_RATE=0.10;
const dishes=[
  { name:{zh:'ÁâõÊéí'}, price:88, category:'‰∏ªÈ£ü'},
  { name:{zh:'Êä´Ëê®'}, price:58, category:'‰∏ªÈ£ü'},
  { name:{zh:'ÊÑèÈù¢'}, price:48, category:'‰∏ªÈ£ü'},
  { name:{zh:'Ê±âÂ†°'}, price:36, category:'‰∏ªÈ£ü'},
  { name:{zh:'ËñØÊù°'}, price:15, category:'Â∞èÂêÉ'},
  { name:{zh:'Â•∂Ëå∂'}, price:18, category:'È•ÆÂìÅ'}
];

// ÁôªÂΩïÊ£ÄÊü•
let currentUser = localStorage.getItem("currentUser");
if(!currentUser){ window.location.href="login.html"; }
else{document.getElementById("userDisplay").innerText="‰ºöÂëò: "+currentUser;}

let cart=[];

function renderCategories(){
  const bar=document.getElementById("categoryBar");
  bar.innerHTML="";
  const cats=["ÂÖ®ÈÉ®",...new Set(dishes.map(d=>d.category))];
  cats.forEach(cat=>{bar.innerHTML+=`<button class="category-btn" onclick="filterCategory('${cat}')">${cat}</button>`;});
}
function filterCategory(cat){renderMenu(cat);}
function renderMenu(cat="ÂÖ®ÈÉ®"){
  const menu=document.getElementById("menu");
  menu.innerHTML="";
  const list=cat==="ÂÖ®ÈÉ®"?dishes:dishes.filter(d=>d.category===cat);
  list.forEach(d=>{
    menu.innerHTML+=`<div class="card" onclick="addToCart('${d.name.zh}')">
      <div class="card-body">
        <h3>${d.name.zh}</h3>
        <p class="price">RM ${d.price.toFixed(2)}</p>
        <button class="add-btn" onclick="event.stopPropagation();addToCart('${d.name.zh}')">Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶</button>
      </div>
    </div>`;
  });
}

function addToCart(name){
  const item=cart.find(i=>i.name===name);
  if(item) item.qty++; else {const dish=dishes.find(d=>d.name.zh===name);cart.push({...dish,qty:1,name});}
  renderCart();
  const cartEl=document.getElementById("cart");
  if(!cartEl.classList.contains("open")) toggleCart();
}

function changeQty(name,delta){const item=cart.find(i=>i.name===name);if(!item)return;item.qty+=delta;if(item.qty<=0) cart=cart.filter(i=>i.name!==name);renderCart();}
function removeItem(name){cart=cart.filter(i=>i.name!==name);renderCart();}

function renderCart(){
  const box=document.getElementById("cartItems");box.innerHTML="";
  let subtotal=0,count=0;
  cart.forEach(i=>{subtotal+=i.price*i.qty;count+=i.qty;
    box.innerHTML+=`<div class="cart-item">
      <div>${i.name} x${i.qty}<br>
        <button class="qty-btn" onclick="changeQty('${i.name}',-1)">-</button> ${i.qty} <button class="qty-btn" onclick="changeQty('${i.name}',1)">+</button>
      </div>
      <div>RM ${(i.price*i.qty).toFixed(2)}<br>
        <button class="remove-btn" onclick="removeItem('${i.name}')">Âà†Èô§</button>
      </div>
    </div>`;
  });
  const discountPercent=parseFloat(document.getElementById("discountSelect").value);
  const discountAmount=subtotal*discountPercent/100;
  const sst=subtotal*SST_RATE, service=subtotal*SERVICE_RATE;
  const grand=subtotal+sst+service-discountAmount;
  document.getElementById("subtotal").innerText="RM "+subtotal.toFixed(2);
  document.getElementById("sst").innerText="RM "+sst.toFixed(2);
  document.getElementById("service").innerText="RM "+service.toFixed(2);
  document.getElementById("discount").innerText="RM "+discountAmount.toFixed(2);
  document.getElementById("grandTotal").innerText="RM "+grand.toFixed(2);
  document.getElementById("cartCount").innerText=count;
}

function toggleCart(){
  const cartEl=document.getElementById("cart");
  const menuEl=document.getElementById("menu");
  cartEl.classList.toggle("open");
  if(cartEl.classList.contains("open")) menuEl.style.marginRight="340px";
  else menuEl.style.marginRight="0";
}
function closeCart(){document.getElementById("cart").classList.remove("open");document.getElementById("menu").style.marginRight="0";}

function checkout(){
  if(!cart.length){alert("Ë¥≠Áâ©ËΩ¶‰∏∫Á©∫");return;}
  const discountPercent=parseFloat(document.getElementById("discountSelect").value);
  const subtotal=cart.reduce((s,i)=>s+i.price*i.qty,0);
  const sst=subtotal*SST_RATE;
  const service=subtotal*SERVICE_RATE;
  const discountAmount=subtotal*discountPercent/100;
  const grand=subtotal+sst+service-discountAmount;

  let orders=JSON.parse(localStorage.getItem("orders_"+currentUser))||[];
  orders.push({time:new Date().toLocaleString(),items:[...cart],subtotal,sst,service,discountAmount,grand});
  localStorage.setItem("orders_"+currentUser,JSON.stringify(orders));

  alert("‰∏ãÂçïÊàêÂäüÔºÅÊÄªÈáëÈ¢ùRM "+grand.toFixed(2));
  cart=[]; renderCart();
  toggleCart();
}

function viewOrderHistory(){
  const historyDiv=document.getElementById("orderHistory");
  const historyList=document.getElementById("historyList"); historyList.innerHTML="";
  const orders=JSON.parse(localStorage.getItem("orders_"+currentUser))||[];
  if(orders.length===0){historyList.innerHTML=`<p>ÊöÇÊó†ËÆ¢Âçï</p>`;}
  else{
    orders.slice().reverse().forEach((o,i)=>{
      let itemsHTML=o.items.map(it=>`${it.name} x${it.qty}`).join("<br>");
      historyList.innerHTML+=`<div class="order-entry"><strong>ËÆ¢Âçï ${orders.length-i} - ${o.time}</strong><br>${itemsHTML}<br>
      <em>ÊÄªÈ¢ù: RM ${o.grand.toFixed(2)}</em></div>`;
    });
  }
  historyDiv.style.display="block";
}
function closeOrderHistory(){document.getElementById("orderHistory").style.display="none";}

function logout(){
  localStorage.removeItem("currentUser");
  window.location.href="login.html";
}

renderCategories(); renderMenu();
</script>
</body>
</html>
